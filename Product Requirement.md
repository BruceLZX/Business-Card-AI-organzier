# BusinessCardAIAssisstant — 产品需求说明（中文）

本文档为当前产品需求的正式说明，包含：
- 联系人/公司档案页的结构、交互与用例
- 目录与创建页的行为
- AI 补全、Tag 规则与语言显示逻辑

---

## 0) 全局规则

1. **系统语言与显示**
   - 默认按系统语言显示内容。
   - 若目标语言缺失，先回退显示已有语言，并后台补齐翻译（用户侧体验为“始终能看到内容”）。
   - 姓名/公司名显示遵循“本名 + 原名辅助”规则（见 1.3/2.3/5.1）。

2. **不翻译字段**
   - 地址、网址、邮箱、电话号码、编号/代码类字段、Tag。

3. **Tag 规则**
   - Tag 不做翻译；生成时按用户当前系统语言输出（专有名词可保留原文）。
   - Tag 必须为单词（无空格/标点）；手动新增允许空格/标点。
   - Tag 先从 tag pool 匹配，未命中才新建。

4. **错误提示**
   - 所有错误提示需中英文版本，显示按系统语言。

---

## 1) 联系人档案页（Detail）

### 1.1 目的
让用户一眼知道“这个人是谁、做什么、怎么联系、属于哪个公司、有哪些照片/标签/备注”。

### 1.2 模块结构（建议顺序）
- 顶部识别区：姓名按系统语言显示；若系统语言与本名不同，则主名下显示原名。
- 语言切换：右上角 EN/中文分段开关，仅影响当前页面显示语言。
- 职位、公司名称（可跳转到公司详情）。
- AI 总结模块：未触发前显示占位文案；触发后显示 AI summary；无结果显示“未在互联网上获得有效信息”。
- 联系信息模块：电话/邮箱/网站/LinkedIn（可点击）。
- 公司关联模块：关联公司列表 + “关联新公司”入口（仅选择已有）。
- 备注模块。
- 标签模块：Tag 列表（不随系统语言翻译）。
- 照片模块：名片/资料图片列表（可全屏查看）。
- 底部操作：删除联系人档案（红色按钮）。

### 1.3 主要用例
1. 查看联系人信息（姓名/职位/联系方式/公司）。
2. 编辑单一模块（关联模块除外）。
3. 语言显示：默认跟随系统语言；顶部 EN/中文切换仅影响当前页面。
4. 关联已有公司（多选）。
5. 解除单个关联（长按/菜单触发）。
6. 照片管理：新增/删除/全屏浏览。
7. 删除联系人：关联公司中的联系人列表同步移除。
8. 姓名显示逻辑：按系统语言显示对应语言名；若系统语言与本名语言不同，则在主名下方显示原名。
9. AI 补全：若未获得有效信息，AI 总结显示“未在互联网上获得有效信息”。
10. AI 更新字段：仅本次更新字段显示蓝色，退出重进后恢复默认色；编辑保存该模块后清除高亮与撤销记录。
11. AI 撤销替换：每个被替换的字段下方都有单独撤销按钮。
12. 编辑态输入框：有明确边框与填充，避免误判是否处于编辑状态。
13. AI 补全完成后，页面应立即显示更新内容（无需退出重进）。

### 1.4 照片交互（联系人）
- 缩略图列表 + 点击全屏浏览。
- 全屏支持左右切换、返回。
- 允许删除照片。

### 1.5 详细测试用例（联系人）
1. 进入联系人详情页，默认按系统语言显示姓名；切换 EN/中文后仅该页语言变化。
2. 编辑“职位/部门/电话”等任一模块并保存，输入框样式清晰可见，保存后恢复默认样式。
3. 点击 AI 补全，页面禁止交互；进度条按阶段变化；完成后仅更新字段显示蓝色。
4. 对任一被替换字段点击“撤销替换”，字段恢复旧值且蓝色高亮清除。
5. 关联已有公司：选择后联系人公司字段更新；返回公司详情页可看到该联系人。
6. 解除关联：在联系人详情页移除关联，公司详情页同步消失。
7. 添加照片后可全屏查看并左右切换；删除照片后列表即时更新。
8. 删除联系人后公司详情页中该联系人不再出现。

---

## 2) 公司档案页（Detail）

### 2.1 目的
让用户一眼知道“公司做什么、规模、业务、如何联系、关联哪些人、有哪些资料图片”。

### 2.2 模块结构（建议顺序）
- 顶部识别区：公司名称按系统语言显示；若系统语言与本名不同，则主名下显示原名。
- 语言切换：右上角 EN/中文分段开关，仅影响当前页面显示语言。
- 公司简介、行业。
- AI 总结模块：同联系人。
- 公司基础信息模块：规模/营收/成立时间/总部/地址/电话。
- 业务模块：服务类型/服务对象（文字输入，推荐格式 B2B/B2C/B2G）/市场区域。
- 链接模块：官网/LinkedIn（可点击）。
- 联系人模块：关联联系人列表 + “关联新联系人”（仅选择已有）。
- 备注模块。
- 标签模块：Tag 列表（不随系统语言翻译）。
- 照片模块：宣传册/资料/名片图片（上限 20）。
- 底部操作：删除公司档案（红色按钮）。

### 2.3 主要用例
1. 查看公司信息（名称/简介/行业/规模/营收等）。
2. 编辑单一模块（关联模块除外）。
3. 语言显示：默认跟随系统语言；顶部 EN/中文切换仅影响当前页面。
4. 关联已有联系人（多选）。
5. 解除单个关联（长按/菜单触发）。
6. 照片管理：新增/删除/全屏浏览。
7. 删除公司：关联联系人所属公司字段清空。
8. 公司详情补全：AI summary 除简介外包含产品/融资/合作/定位等信息（不重复公司基础字段）。
9. AI 更新字段：仅本次更新字段显示蓝色，退出重进后恢复默认色；编辑保存该模块后清除高亮与撤销记录。
10. AI 撤销替换：每个被替换的字段下方都有单独撤销按钮。
11. 编辑态输入框：有明确边框与填充，避免误判是否处于编辑状态。
12. AI 补全完成后，页面应立即显示更新内容（无需退出重进）。

### 2.4 照片交互（公司）
- 上限 20 张。
- 缩略图区固定高度，可上下滚动。
- 点击进入全屏浏览，支持左右切换/返回。

### 2.5 详细测试用例（公司）
1. 进入公司详情页，名称按系统语言显示，若语言不一致则展示原名辅助。
2. 编辑“行业/规模/服务类型/市场区域”等字段并保存，文本框样式清晰；保存后不再高亮。
3. AI 补全后 Summary 不重复“公司基础信息”字段内容，内容面向投资人/客户/合作伙伴。
4. 对每个被替换字段可点击撤销；撤销后恢复旧值且高亮消失。
5. 关联已有联系人，联系人详情页显示该公司；解除关联后双方同步更新。
6. 添加多张图片，缩略图区固定高度可滚动；全屏浏览可左右切换。
7. 删除公司后关联联系人公司字段清空。

---

## 3) 关联模块交互规范

1. 关联对象列表支持滚动（固定高度约 3 个对象的高度）。
2. “关联新 / 删除关联”按钮固定在列表底部，不随滚动。
3. 删除关联按钮为红色危险样式。
4. 支持多选删除：进入选择模式后勾选多个并二次确认。

---

## 4) 目录页（名录）

1. 列表按系统语言显示联系人/公司名称。
2. 若目标语言缺失，回退显示已有语言并后台补齐。
3. 标签在列表中显示时不翻译。
4. 列表项支持长按删除（需二次确认）。
5. 搜索与筛选：支持按位置/服务类型/服务对象/标签/市场区域筛选。

### 4.1 详细测试用例（名录）
1. 列表按系统语言显示名称；切换系统语言后列表文案即时变化。
2. 对缺失语言字段，列表先显示已有语言并后台补齐。
3. 长按删除联系人/公司需二次确认，删除后本地数据同步更新。
4. 筛选多个条件并确认，列表仅显示符合条件的条目。

---

## 5) 创建页（原“拍照页”）

1. 页面名称统一为“创建”。
2. 最近创建列表按系统语言显示名称与副标题。
3. 点击底部 Tab 时，必须回到各自根页面（创建/名录/设置）。
4. 最近创建列表支持长按删除（需二次确认）。
5. 创建完成后自动生成 Tag（按系统语言生成，遵循 Tag 规则；失败不阻断创建）。
6. 创建时若同时存在中英文名：默认中文为本名；若 AI 能根据版式判断大小，则以更大的名字为本名。
7. 扫描创建流程：先走视觉解析（多图）；若解析失败再用 OCR 文本兜底。
8. 名称字段标注：Name 为本名，Original Name 为原名；根据识别结果预填。
9. 创建时若缺失另一语言姓名，自动翻译补齐（不覆盖手动输入）。
10. Original Name 代表“原始语言名称”，不等同于“中文名”。

### 5.1 详细测试用例（创建）
1. 进入创建页，默认在“创建”标签页，点击底部任意 Tab 都返回各自根页面。
2. 使用扫描创建联系人，若识别到公司名称且公司已存在，提示选择已有公司；选择后仅展示精简信息（名称/原名/行业/位置/官网）。
3. 扫描仅识别单语言姓名时，自动补齐另一语言姓名；若用户手动填写则不覆盖。
4. 创建完成后自动生成 Tag；生成失败不阻断保存。
5. 最近创建列表按系统语言展示名称与副标题，长按删除需二次确认。

---

## 6) AI 补全

### 6.1 入口与交互
- 入口按钮在档案顶部；点击后按钮变为进度条。
- 补全过程中禁止编辑与关键按钮操作（不要求阻止返回/切换页面）。
- 进度条仅在阶段完成后推进（非定时模拟）。
- 不显示屏幕中央浮层进度条。
- 若最终未获得有效信息，AI 总结显示“未在互联网上获得有效信息”（仅在“网络无结果 + 图片/已知信息也不足以生成总结”的特殊情况）。

### 6.2 阶段与流程
1. 照片内容分析（mini 模型）。
2. 联网搜索（thinking 模型，多阶段）。
3. 合并去重与输出。
4. 搜索策略：若判断为中国人/中国公司（中文内容、地址/域名/地点等），先中文互联网搜索再国际搜索；否则优先国际搜索。

### 6.3 结果与对比
- 更新字段显示为蓝色。
- 若字段被更新，显示原有内容用于对比。
- 若原字段非空，每个被替换字段下方都提供“撤销替换”按钮。
- 未编辑的新字段仅在本次补全可见为蓝色，退出重进或手动编辑后恢复默认色。

### 6.4 质量与安全
- 对照现有信息校验，避免同名误入。
- 不确定内容用【可能不准确】标记到字段/段落级。
- 若识别到官网/LinkedIn/个人网站，优先基于这些链接搜索。
- 扮演潜在用户/投资人/合作伙伴视角，补全应包含可用于判断价值的信息（如核心产品、融资、客户/合作、竞争位置），避免与“公司基础信息”重复。
- 若网络搜索无结果，但图片/已知信息存在，Summary 需基于图片/已知信息生成，不得直接落入“未在互联网上获得有效信息”。

### 6.5 Tag 生成
- 生成 tag 使用 mini 模型。
- Tag 按当前系统语言生成（专有名词保留原文）。
- 先从 tag pool 匹配；未命中才新建。
- 创建时也应生成 Tag，非仅 AI 补全时生成。

### 6.6 失败提示（中英文）
- 缺少 API Key
- 网络错误
- 解析失败
- 返回空结果

### 6.7 详细测试用例（AI 补全）
1. 无 API Key 时提示“缺少 API Key”，并且不会进入补全过程。
2. 补全中 UI 不可编辑；进度条随阶段推进；允许用户离开页面。
3. 补全完成后页面立即显示更新文本；退出重进后高亮消失。
4. 返回结果与现有字段重复时不覆盖；Summary 不复述基础字段。
5. 网络无结果但图片/已知信息存在时，Summary 依然生成；仅在信息不足时显示“未在互联网上获得有效信息”。

---

## 7) 语言与翻译策略（工程约束）

1. 翻译触发时机：创建/编辑保存/AI 补全完成后后台翻译；打开详情页若缺失再补齐。
2. 翻译结果缓存到本地，字段变更才重新翻译。
3. Tag 不翻译，仅按生成语言显示。
4. 英文人名翻译为中文时使用音译，不生成“中文名”。

---

## 8) 问题列表
1. 创建新的人员档案时，我有一个人员的公司已经有档案了，但是我创建这个人的档案的时候新建公司的tab并没有跳出疑似公司的推荐，明明扫描出来的公司名字是一样的。我怀疑创建新档案的时候扫描已有档案，提示档案以存在的功能是否有在正常工作。但是手动添加已有公司的功能还是正常工作的，但是选择以后会在顶上列出已有公司档案的所有信息，看上去很烦，没必要显示这部分内容。
2. ai补全功能仍然不太完善，公司部分的ai总结会重复公司详情这部分已经填写的内容。内容不应该重复。ai总结提供的内容是面向潜在的投资人/客户/合作伙伴的同时不应该重复已有内容。比如，你可以描述这家公司有具体什么产品，是否有官司，有没有融资，几轮？融资规模？等等信息。我举例的不完全，你可以自己带入上面的这些角色中，想想你还会想要了解什么方面的内容。
3. 创建档案的时候，ai在缺乏名字的双语名字的时候自动翻译补全另一个语言的名字的功能又失效了。
4. 你的product requirement和user case的描述太简略了，导致我之前要求的功能你没有细节的描述，在后续的update中把之前的功能/要求给顶掉了。请你根据现在app具有的功能列出更加详细的user test case以及product requirement。

### 8.1 解决方案与逻辑（工程视角）
1. **创建联系人时未提示已有公司 + 选择后显示过多信息**
   - 触发条件：扫描创建联系人时若识别到公司名，应触发“已有公司匹配”检测。
   - 方案：在创建流程中，当预填类型为 contact 且公司名存在时也执行公司匹配；预填完成后自动检测并弹出匹配提示。
   - UI 调整：已存在公司仅显示精简信息（名称/原名/行业/位置/官网），不展示完整档案，避免噪音。
2. **公司 AI Summary 重复基础字段**
   - 方案：强化补全 prompt，显式禁止复述“现有字段”，并传入现有字段清单作为不可重复内容。
   - 约束：Summary 只提供新信息（产品/融资/客户/合作/竞争位置/商业模式等）。
   - 补充：若网络无结果但图片/已知信息存在，Summary 需由这些信息生成；仅在信息不足时显示“未在互联网上获得有效信息”。
3. **创建时双语姓名自动翻译失效**
   - 方案：创建页预填后自动检测“只有一种语言姓名”的情况，用 TranslationService 补齐另一语言；不覆盖用户已手动输入的字段。
4. **需求/用例描述不够详细**
   - 方案：补充每个模块的详细测试用例与交互细节，避免需求被覆盖或误解。

### 8.2 To Do List（执行清单）
1. 在创建流程中开放“联系人预填时的公司匹配提示”，并在预填后自动触发匹配检查。
2. 精简“已有公司信息”展示，仅保留关键字段。
3. 增加创建页双语姓名自动翻译逻辑（缺一补一，不覆盖手填）。
4. 强化 AI Summary prompt，明确“不要复述现有字段/summary/notes”。
5. 补充联系人/公司/创建/AI/名录的详细测试用例与需求细节。

## 9) 工程与配置说明

### 9.1 技术栈
- SwiftUI + 本地存储。
- OpenAI Responses API（视觉解析、补全、翻译）。

### 9.2 项目结构
- `BusinessCardAIAssisstant/` 应用源码
- `BusinessCardAIAssisstant/App/` 入口、设置、全局状态与文案
- `BusinessCardAIAssisstant/UI/` 页面与组件
- `BusinessCardAIAssisstant/Models/` 数据模型与筛选规则
- `BusinessCardAIAssisstant/Services/` 解析、补全、翻译、搜索
- `BusinessCardAIAssisstant/Storage/` 本地存储与图片管理
- `BusinessCardAIAssisstant/Resources/` 资源文件
- `BusinessCardAIAssisstant/Assets.xcassets/` 图标与颜色资源

### 9.3 本地配置
1. 创建 `BusinessCardAIAssisstant/Secrets.xcconfig`：
   ```
   OPENAI_API_KEY = your_key_here
   ```
2. 打开 `BusinessCardAIAssisstant.xcodeproj` 运行。

### 9.4 AI 配置（本地、Git 忽略）
- 模型选择与 prompt 集中在 `BusinessCardAIAssisstant/App/AIConfig.swift`。
- 该文件已被 `.gitignore` 排除，不会提交到仓库。
- 每段 prompt 都有注释说明用途与调用位置。

---

本 README 作为后续开发的唯一基准。
