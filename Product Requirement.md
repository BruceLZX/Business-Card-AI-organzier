# BusinessCardAIAssisstant — 产品需求说明（中文）

本文档为当前产品需求的正式说明，包含：
- 联系人/公司档案页的结构、交互与用例
- 目录与创建页的行为
- AI 补全、Tag 规则与语言显示逻辑

---

## 0) 全局规则

1. **系统语言与显示**
   - 默认按系统语言显示内容。
   - 若目标语言缺失，先回退显示已有语言，并后台补齐翻译。
   - 姓名/公司名显示遵循“本名 + 原名辅助”规则（见 1.3/2.3/5.1）。

2. **不翻译字段**
   - 地址、网址、邮箱、电话号码、编号/代码类字段、Tag。

3. **Tag 规则**
   - Tag 不做翻译；生成时按用户当前系统语言输出（专有名词可保留原文）。
   - Tag 必须为单词（无空格/标点）；手动新增允许空格/标点。
   - Tag 先从 tag pool 匹配，未命中才新建。

4. **错误提示**
   - 所有错误提示需中英文版本，显示按系统语言。

---

## 1) 联系人档案页（Detail）

### 1.1 目的
让用户一眼知道“这个人是谁、做什么、怎么联系、属于哪个公司、有哪些照片/标签/备注”。

### 1.2 模块结构（建议顺序）
- 顶部识别区：姓名按系统语言显示；若系统语言与本名不同，则主名下显示原名。
- 语言切换：右上角 EN/中文分段开关，仅影响当前页面显示语言。
- 职位、公司名称（可跳转到公司详情）。
- AI 总结模块：未触发前显示占位文案；触发后显示 AI summary；无结果显示“未在互联网上获得有效信息”。
- 联系信息模块：电话/邮箱/网站/LinkedIn（可点击）。
- 公司关联模块：关联公司列表 + “关联新公司”入口（仅选择已有）。
- 备注模块。
- 标签模块：Tag 列表（不随系统语言翻译）。
- 照片模块：名片/资料图片列表（可全屏查看）。
- 底部操作：删除联系人档案（红色按钮）。

### 1.3 主要用例
1. 查看联系人信息（姓名/职位/联系方式/公司）。
2. 编辑单一模块（关联模块除外）。
3. 语言显示：默认跟随系统语言；顶部 EN/中文切换仅影响当前页面。
4. 关联已有公司（多选）。
5. 解除单个关联（长按/菜单触发）。
6. 照片管理：新增/删除/全屏浏览。
7. 删除联系人：关联公司中的联系人列表同步移除。
8. 姓名显示逻辑：按系统语言显示对应语言名；若系统语言与本名语言不同，则在主名下方显示原名。
9. AI 补全：若未获得有效信息，AI 总结显示“未在互联网上获得有效信息”。
10. AI 更新字段：仅本次更新字段显示蓝色，退出重进后恢复默认色；编辑保存该模块后清除高亮与撤销记录。
11. AI 撤销替换：每个被替换的字段下方都有单独撤销按钮。
12. 编辑态输入框：有明确边框与填充，避免误判是否处于编辑状态。

### 1.4 照片交互（联系人）
- 缩略图列表 + 点击全屏浏览。
- 全屏支持左右切换、返回。
- 允许删除照片。

---

## 2) 公司档案页（Detail）

### 2.1 目的
让用户一眼知道“公司做什么、规模、业务、如何联系、关联哪些人、有哪些资料图片”。

### 2.2 模块结构（建议顺序）
- 顶部识别区：公司名称按系统语言显示；若系统语言与本名不同，则主名下显示原名。
- 语言切换：右上角 EN/中文分段开关，仅影响当前页面显示语言。
- 公司简介、行业。
- AI 总结模块：同联系人。
- 公司基础信息模块：规模/营收/成立时间/总部/地址/电话。
- 业务模块：服务类型/服务对象（文字输入，推荐格式 B2B/B2C/B2G）/市场区域。
- 链接模块：官网/LinkedIn（可点击）。
- 联系人模块：关联联系人列表 + “关联新联系人”（仅选择已有）。
- 备注模块。
- 标签模块：Tag 列表（不随系统语言翻译）。
- 照片模块：宣传册/资料/名片图片（上限 20）。
- 底部操作：删除公司档案（红色按钮）。

### 2.3 主要用例
1. 查看公司信息（名称/简介/行业/规模/营收等）。
2. 编辑单一模块（关联模块除外）。
3. 语言显示：默认跟随系统语言；顶部 EN/中文切换仅影响当前页面。
4. 关联已有联系人（多选）。
5. 解除单个关联（长按/菜单触发）。
6. 照片管理：新增/删除/全屏浏览。
7. 删除公司：关联联系人所属公司字段清空。
8. 公司详情补全：AI summary 除简介外包含产品/融资/合作/定位等信息（不重复公司基础字段）。
9. AI 更新字段：仅本次更新字段显示蓝色，退出重进后恢复默认色；编辑保存该模块后清除高亮与撤销记录。
10. AI 撤销替换：每个被替换的字段下方都有单独撤销按钮。
11. 编辑态输入框：有明确边框与填充，避免误判是否处于编辑状态。

### 2.4 照片交互（公司）
- 上限 20 张。
- 缩略图区固定高度，可上下滚动。
- 点击进入全屏浏览，支持左右切换/返回。

---

## 3) 关联模块交互规范

1. 关联对象列表支持滚动（固定高度约 3 个对象的高度）。
2. “关联新 / 删除关联”按钮固定在列表底部，不随滚动。
3. 删除关联按钮为红色危险样式。
4. 支持多选删除：进入选择模式后勾选多个并二次确认。

---

## 4) 目录页（名录）

1. 列表按系统语言显示联系人/公司名称。
2. 若目标语言缺失，回退显示已有语言并后台补齐。
3. 标签在列表中显示时不翻译。
4. 列表项支持长按删除（需二次确认）。
5. 搜索与筛选：支持按位置/服务类型/服务对象/标签/市场区域筛选。

---

## 5) 创建页（原“拍照页”）

1. 页面名称统一为“创建”。
2. 最近创建列表按系统语言显示名称与副标题。
3. 点击底部 Tab 时，必须回到各自根页面（创建/名录/设置）。
4. 最近创建列表支持长按删除（需二次确认）。
5. 创建完成后自动生成 Tag（按系统语言生成，遵循 Tag 规则；失败不阻断创建）。
6. 创建时若同时存在中英文名：默认中文为本名；若 AI 能根据版式判断大小，则以更大的名字为本名。
7. 扫描创建流程：先走视觉解析（多图）；若解析失败再用 OCR 文本兜底。
8. 名称字段标注：Name 为本名，Original Name 为原名；根据识别结果预填。

---

## 6) AI 补全

### 6.1 入口与交互
- 入口按钮在档案顶部；点击后按钮变为进度条。
- 补全过程中禁止编辑与交互（页面不可返回/切换）。
- 进度条仅在阶段完成后推进（非定时模拟）。
- 不显示屏幕中央浮层进度条。
- 若最终未获得有效信息，AI 总结显示“未在互联网上获得有效信息”。

### 6.2 阶段与流程
1. 照片内容分析（mini 模型）。
2. 联网搜索（thinking 模型，多阶段）。
3. 合并去重与输出。
4. 搜索策略：若判断为中国人/中国公司（中文内容、地址/域名/地点等），先中文互联网搜索再国际搜索；否则优先国际搜索。

### 6.3 结果与对比
- 更新字段显示为蓝色。
- 若字段被更新，显示原有内容用于对比。
- 若原字段非空，每个被替换字段下方都提供“撤销替换”按钮。
- 未编辑的新字段仅在本次补全可见为蓝色，退出重进或手动编辑后恢复默认色。

### 6.4 质量与安全
- 对照现有信息校验，避免同名误入。
- 不确定内容用【可能不准确】标记到字段/段落级。
- 若识别到官网/LinkedIn/个人网站，优先基于这些链接搜索。
- 扮演潜在用户/投资人/合作伙伴视角，补全应包含可用于判断价值的信息（如核心产品、融资、客户/合作、竞争位置），避免与“公司基础信息”重复。

### 6.5 Tag 生成
- 生成 tag 使用 mini 模型。
- Tag 按当前系统语言生成（专有名词保留原文）。
- 先从 tag pool 匹配；未命中才新建。
- 创建时也应生成 Tag，非仅 AI 补全时生成。

### 6.6 失败提示（中英文）
- 缺少 API Key
- 网络错误
- 解析失败
- 返回空结果

---

## 7) 语言与翻译策略（工程约束）

1. 翻译触发时机：创建/编辑保存/AI 补全完成后后台翻译；打开详情页若缺失再补齐。
2. 翻译结果缓存到本地，字段变更才重新翻译。
3. Tag 不翻译，仅按生成语言显示。
4. 英文人名翻译为中文时使用音译，不生成“中文名”。

---

## 8) 问题列表
（待补充）

### 8.1 解决方案与逻辑（工程视角）
（待补充）

### 8.2 To Do（执行清单）
（待补充）

## 9) 工程与配置说明

### 9.1 技术栈
- SwiftUI + 本地存储。
- OpenAI Responses API（视觉解析、补全、翻译）。

### 9.2 项目结构
- `BusinessCardAIAssisstant/` 应用源码
- `BusinessCardAIAssisstant/App/` 入口、设置、全局状态与文案
- `BusinessCardAIAssisstant/UI/` 页面与组件
- `BusinessCardAIAssisstant/Models/` 数据模型与筛选规则
- `BusinessCardAIAssisstant/Services/` 解析、补全、翻译、搜索
- `BusinessCardAIAssisstant/Storage/` 本地存储与图片管理
- `BusinessCardAIAssisstant/Resources/` 资源文件
- `BusinessCardAIAssisstant/Assets.xcassets/` 图标与颜色资源

### 9.3 本地配置
1. 创建 `BusinessCardAIAssisstant/Secrets.xcconfig`：
   ```
   OPENAI_API_KEY = your_key_here
   ```
2. 打开 `BusinessCardAIAssisstant.xcodeproj` 运行。

### 9.4 AI 配置（本地、Git 忽略）
- 模型选择与 prompt 集中在 `BusinessCardAIAssisstant/App/AIConfig.swift`。
- 该文件已被 `.gitignore` 排除，不会提交到仓库。
- 每段 prompt 都有注释说明用途与调用位置。

---

本 README 作为后续开发的唯一基准。
